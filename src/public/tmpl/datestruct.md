## 数据结构

在之前的章节当中，我们已经接触了大量的python常用数据类型和数据结构。我们知道常用的是数字和字符串，复合类型的有列表，字典元组等。在本章节，我们将对这些数据类型和数据结构进行较为详细的讲解，对其常见的用法进行简单介绍，并对其常见函数/方法进行介绍。

### 常用数据结构及其用法

#### 字符串类型

字符串类型是python当中相当常见的基础数据类型，我们可以使用`''`，`""`和`''''''`进行字符串的创建，如下：

```python
str1 = 'hello'
str2 = "world"
str3 = '''let`s go python!'''
```

字符串创建完成之后，我们可以对字符串做各种操作。

- 获取字符串的长度：`len(str1)`
- 获取字符串的第一个字符：`str1[0]`
- 获取字符串的最后一位字符：`str1[-1]`
- 获取字符串的第2位到第4位字符：`str1[1:4]`

在上述的操作当中，除了第一个操作是求取字符串的长度之外，其余的操作都是在针对字符串的特定的位置的字符进行求解。这种操作称之为字符串的 ***切片*** 操作。在之后的讲解当中，我们还会遇到针对列表、元组和字典等类型的切片操作。因此，在这里我们对切片操作进行进行简单的定义：**针对可迭代的基础输出，其元素被顺序放置的一种数据结构类型，这种方式允许通过下标的方式来获得某一个数据元素，或者通过指定下标范围来获得一组序列的元素。这种访问序列的方式叫做切片。字符串也可以使用切片操作。切片操作符：[]  [:]  [::]，调用内置函数slice()函数**。

```python
str1 = 'hello world'

print str1[0:] #复制相同的字符串
print str1[:-1] #复制字符串直到末尾之前
print str1[0:-1] #复制字符串直到末尾之前
print str1[0:-1:2] #复制字符串直到末尾之前，但是每隔2个复制
print str1[:] #复制相同的字符串
print str1[::] #复制相同的字符串
print str1[::-1] #字符串翻转
```

除了常见的切片操作之外，字符串也支持常见的`+`和`*`运算。但是，`+`表示的是字符串连接，a和b字符串连接为新的字符串；`*`则表示的是重复操作，a*3表示将字符串a重复3次，生成新的字符串：

```python
a = 'hello'
b = 'world'

c = a + b
d = a * 3

print c
print d
```

字符串的连接操作使用比较频繁，按照我们之前的讲解，我们可以不断的使用`+`操作符，获得我们想要的任何连接字符串结果。但是，和其他语言一样，如果频繁的使用`+`操作符，会导致字符串操作出现很多的内存浪费。因此，在频繁的`+`操作时，我们通常会采用另外的方式进行。

```python
a = 'hello'
b = 'world'

c = ''.join([a,b])
```

采用`join`进行频繁的字符串连接操作是通常的方式。

除了对字符串的拼接和剪切之外，有的时候，我们需要判断字符串当中是否包含特定的内容。虽然字符串本身具有`index`函数，来判断是否包含相关字符串，但是，我们有的时候，更加常用的是`in`关键字，用成员判断来标识内容是否存在于字符串当中。

```python
str1 = 'hello world'

print 'hello' in str1
print 'lets' not in str1
```

字符串的很多特点都和我们接下来需要将的列表非常类似，因此有的时候，字符串也被戏称为“只包含字符的列表”。

字符串很重要的一个操作就是输出。对字符串进行输出，我们才能知道字符串的内容。关于字符串的输出，我们通常称之为格式化，比如：

```python
print "My name is %s and weight is %d kg!" % ('Zara', 21)
```

常用的格式化操作符如下表：
|   操作符  |   含义           |
| --------- | ---------       |
| %c       | 格式化字符        |
| %s       | 格式化字符串      |
| %d       | 格式化整数        |
| %u       | 格式化无符号整数   |
| %f       | 格式化浮点数       |

#### 列表

列表是Python当中使用非常广泛的一种符合类型数据。列表的使用在Python的编码过程中非常重要。在之前的介绍当中，我们已经了解了列表的形式，在本章节当中我们将详细介绍列表的细节和具体使用。

通常的，python的列表就是使用'[]'包裹起来的数据。下面的数据都是合法列表的不同表示形式：

```python
a = [1,2,3]
b = [1,2,'a']
c = [1,'c',3]
d = [1,'c',[1,2,3]]
e = [1,2,'abc', [1,2], {'name': 'cloud'}]
```

Python的列表当中，每一项都称之为列表的元素，列表的元素必须是合法的Python数据类型，可以是字母数字，列表字典以及python的其他对象。

和之前所说的一样，字符串是“只包含字符的列表”，字符串的很多操作，对于列表而言，都是适用的。比如列表的切片操作，和字符串的一模一样：

```python
e = [1,2,'abc', [1,2], {'name': 'cloud'}]

print e[0:-1:2]
print e[0:]
print e[:]
print e[::]
print e[::-1]
```

关于列表的切片操作，我们不再讲述，请仔细参考字符串章节的切片操作。而列表的元素的访问，也同字符串一样，使用下标进行。比如访问列表当中的第4位的元素，只需要采用`e[4]`就可以访问。列表元素的访问，也和字符串的访问方式相同，这里不再赘述。

在之前函数参数部分，我们提到了字符串本身是不可变的变量，而列表是可变的。因此，我们看看如何对列表本身进行更新操作。

现在有一个列表，我们需要替换他的第2号位上的元素。

```python
e = [1,2,'abc', [1,2], {'name': 'cloud'}]
e[2] = [2,3,4] #替换e列表的第2位上的元素
print e
```

和字符串不一样的是，如果需要更新列表当中的元素，只需要通过赋值操作，即可修改元素的值。

除了直接修改元素的值，我们还可以删除列表的元素，以及增加列表的元素。请看下面的代码：

```python
e = [1,2,'abc', [1,2], {'name': 'cloud'}]
del e[3] #删除列表的第3个元素
print e
e.append(3) #将3附加到列表e的最后
print e
e.insert(4, {'age': 18}) #将字典插入到列表e的第4位
```

需要注意的是，列表的`insert`操作需要指定插入的位置，如果这个位置不存在，则会在列表的最后直接追加元素；而`append`操作则只会在列表的最末尾追加元素。

在上面的代码当中，我们看到了关键字`del`。在例子当中，我们使用了del关键字进行元素的删除。`del`不仅可以删除列表当中的元素，还可以删除其他集合类型当中的元素。除了使用`del`关键字进行元素的删除之外，我们还可以使用另外的方式进行元素的删除：

```python
e.remove('abc')
```

和`del`关键字不一样的是，remove方法需要指定元素的内容。上面的代码表示的意思是：从列表e当中删除abc这个元素。但是，如果列表当中存在多个'abc'，`remove`操作只会移除列表当中从左到右的第一个符合条件的元素。如果列表当中不存在需要的元素，则会直接提示异常错误：

```python
e.remove(5)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ValueError: list.remove(x): x not in list
```

***特别注意的是，del关键字可以删除变量***。

除了以上2种删除的方式之外，符合类型（包括字典）还有另外一种删除的方式。这种方式在python的实际使用中非常普遍。

```python
e = [1,2,'abc', [1,2], {'name': 'cloud'}]
item = e.pop(2)
print item
print e
```

在上述删除操作当中，我们使用了pop操作。`pop`操作主要是将集合当中，位置为x的元素删除，同时返回这个元素的内容。以上的代码执行之后，e这个列表当中，'abc'这个变量不再存在，而item的值则变成了'abc'。如果pop操作当中，对应的索引上不存在元素，则会提示错误。

和字符串一样，列表同样支持成员操作：

```python
e = [1,2,'abc', [1,2], {'name': 'cloud'}]
print 5 in e
print 2 in e
print [1,2] in e
```

列表同样支持多个列表的合并操作。和字符串一样，我们可以使用`+`进行操作，但是，基于同样的原因，我们并不推荐在真实的环境下使用该操作符。对于列表，我们有更好的操作方式：

```python
a = [43, -1.23, -2]
b = ['jack', 'jumped', 'over', 'candlestick']
a.extend(b)
print a
```

我们通过简单的extend操作，就可以直接将b这个列表附加到a列表之后。

除了这些操作之外，python的列表还支持更多的操作：

- 求列表的长度：`len(e)`
- 求列表元素的最大和最小值：`max([1,2,3])`, `min([2,3,1])`
- 求数值型列表的元素和：`sum([1,2,3])`

到此，我们已经基本了解了列表的基本特性和常用方法。接下来，我们会讲解列表在python当中非常重要的一个特性：列表推导，有的时候也称之为列表解析。

我们都知道列表是一个一个的元素的集合，如果我们需要构造一个列表，除了直接进行初始化之外，通常需要通过循环进行，如下：

```python
e = []
for item in range(10):
    e.append(item)
```

如果我们需要对这些元素进行操作，或者判断，就需要在上述代码当中加入逻辑判断，或者其他操作，比如：

```python
e = []
for item in range(10):
    if item % 2 == 0:
        e.append(item * 3)
```

但是，由于列表的特殊性，我们可以通过列表推导的方式来进行列表的构造，我们以上述代码为例，将这段代码转换为列表推导的方式：

```python
e = [item*3 for item in range(10) if item %2 == 0]
d = [item*3 for item in [1,2,3,4,5,6] if item %2 == 0]
```

上述代码当中，item*3，表示构造新列表的元素，`for item in range(10)`则表示，item的来源是range函数的结果，`if item %2 == 0`，表示满足这样的条件的item才会进行item×3的操作，并纳入到新的列表当中。不仅可以使用range和列表实现列表推导操作，实际上，我们还可以使用字典，迭代器等等实现列表推导。列表推导不仅仅可以用来生成新的列表，很多的时候也用来作为元素的过滤。

#### 字典

字典是另外一种python当中非常常用的数据类型。字典是另一种可变容器模型，且可存储任意类型对象。通常的表示是，字典是一种键值对类型。字典的元素由键和对应的值构成，因此，字典的键不能重复，具有唯一性，如果重复最后的一个键值对会替换前面的，值不需要唯一。值可以取任何数据类型，但键必须是不可变的，如字符串，数字或元组。在之前的例子当中，我们已经见到了很多的字典：

```python
dict1 = {'name': 'cloud', 1: 34, (1,2): 'stack'}
```

和列表不一样，列表当中的数据是按照顺序进行存储的。字典在实现过程中使用了哈希表的算法。哈希表的算法是获取键，对键执行一个叫做哈希函数的操作，并根据计算的结果，选择在数据结构的某个地址中来存储你的值。任何一个值存储的地址皆取决于它的键。正因为这种随意性，哈希表中的值是没有顺序的。所以，字典是一个无序的数据集。由于哈希表有很好的性能，因此，字典的性能是非常好的。

构造一个字典除了使用直接定义的方式之外，我们还可以使用`dict`函数进行定义。

```python
a = dict(name='cloud', age=18, score=99)
print a
```

字典定义完成之后，我们需要使用一定的方式来访问字典，以及字典当中的元素。访问字典当中的元素非常简单，只要通过访问字典当中的键，就可以得到键所对应的值。

```python
a = dict(name='cloud', age=18, score=99)
print a['name']
print a['age']
print a['score']
```

但是如果访问的字典当中不存在对应的键值对，则会提示错误：

```python
a = dict(name='cloud', age=18, score=99)
print a['sex']
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
KeyError: 'sex'
```

如果需要修改字典当中对应的键的值，只需要进行简单的赋值操作即可：

```python
a = dict(name='cloud', age=18, score=99)
a['name'] = 'stack'
a['num'] = 19
```

需要注意的，对字典的键进行赋值操作，不仅仅可以修改对应的键的值，如果对应的键不存在，则赋值操作相当于往字典当中新增数据，如上述代码所见。

但是，如果我们需要一次性的更新多个键值对，或者增加多个键值对，可以选择的方法是在for循环当中，不断的进行赋值操作进行更新或者增加操作。不过这个明显是一个不好的方法。字典本身提供了一个更好的方法：

```python
a = {'name': 'cloud', 'age': 18, 'id': 1}
a.update({'key': 'value', 'time': 'current'})
print a
```

在使用updatec操作的时候，需要注意的是，update的参数本身就是一个字典。

如果需要删除字典当中的元素，我们就需要使用`del`关键字。在列表章节当中，我们已经讲解了del在删除列表元素时的使用方式，和删除列表元素操作类似的是，删除字典元素，我们也可以直接使用del关键字。同样的，如果我们需要删除整个字典，也可以使用del关键字进行操作。

```python
a = {'name': 'cloud', 'age': 18, 'id': 1}
del a['id']
print a
del a
```

除了直接使用del进行元素和字典的删除之外，在之前的列表的章节，我们提到了pop函数对列表的元素进行删除，同样的，我们也可以使用pop对字典的元素进行删除：

```python
a = {'name': 'cloud', 'age': 18, 'id': 1}
removed_item = a.pop('name')
print a
print removed_item
```

除了这些更新，删除的操作之外，字典的访问是一个比较重要的内容。在上面的内容当中，我们已经知道了字典是键值对(key-value)组成的数据结构。但是，给定一个字典，我们有可能是不知道字典存在哪些键的；字典也是多个元素的集合，到底有多少个元素，我们应该如何知道呢？

```python
a = {'name': 'cloud', 'age': 18, 'id': 1}
print len(a)
print a.keys()
```

在之前的字符串和列表章节，我们知道通过`len`函数获取字符串和列表元素的个数或者长度。这个操作同样适用于字典。只不过，len这个操作获得的不再是字典的长度，而是字典包含的元素的个数。在上述代码当中，我们看到了一个新的操作`a.keys()`。该函数的作用是获取一个字典到底有哪些键（key）。在上述的代码当中，a.keys()的输出是'name'，'age'和'id'，也就是说，这个字典是由这几个键和他们所对应的值组成的。

既然我们可以获得字典的键，相对应的，我们是否可以直接获得字典包含了哪些值。很明显，是可以的。

```python
a = {'name': 'cloud', 'age': 18, 'id': 1}
print a.values()
```

但是问题又来了：我们得到了键，也得到了值，但是，却没办法将其对应起来。我们是否可以将这些键和值对应起来呢？

```python
a = {'name': 'cloud', 'age': 18, 'id': 1}
print a.items()
```

通过`items`，我们就获得了键值对的对应关系。但是这些键值对构成的是一个列表，这个列表的每个元素都是一个元组。由于python本身支持同时对多个变量赋值，因此，我们在实际使用的时候，通常以如下的方式来对字典进行遍历访问：

```python
a = {'name': 'cloud', 'age': 18, 'id': 1}
for key, value in a.items():
    print 'key is %s and value is %s' %(key, value)
```

在访问字典的时候，除了通过for循环逐次进行遍历之外，在之前的内容和章节当中，我们提到，字典的访问可以直接通过`a[key]`的方式。但是我们也提到，如果对应的key在字典当中不存在，则会出现错误。那是否存在一种方法，如果对应的键不存在，返回一个默认的值？答案是肯定的。

```python
a = {'name': 'cloud', 'age': 18, 'id': 1}
print a.get('name')
print a.get('score', 0)
```

字典的get方法，可以直接通过对键的索引来获取对应的值。不多，在上述的代码当中，我们看到，get方法可以接收2个参数。`a.get('score', 0)`表示的意思就是，从a这个字典当中获取名为score的键对应的值，如果这个键并不存在，则返回0。也就是说，默认score这个键所对应的值就是0。通过get方法，我们可以有效的避免在访问不存在的键时，出现的key错误。

除了使用`get`方法在获取的阶段判断key是否存在之外，有的时候，我们需要根据对应的字典是否存在需要的键做判断。此时，如果用get方法，则是有些多余的。如何判断一个键是否在字典当中，在这里，会继续使用在字符串和列表当中频繁使用到的成员操作`in`来判断。

```python
a = {'name': 'cloud', 'age': 18, 'id': 1}
print 'name' in a
print 'cloud' not in a
```

需要注意的是，对字典进行成员操作，***针对的是字典的键，并不是字典的值***。

### 课后作业

- 请运行字符串类型章节的代码，分析代码的输出结果。
- 字符串a为'hello world', 字符串b为'let us go', 使用`join`操作，将a和b用`-`进行连接，构成'hello world-let us go'
- 练习字符串的切片操作。
- 通过`pydoc str`查看字符串的操作函数，并使用`isspace`，`islower`，`isupper`和`lower`操作字符串，观察并分析结果。
- 构造一个列表
- 从列表当中删除最后一个元素
- 在列表的第二位插入一个元素，元素的值是'hello'
- 在列表的末尾追加一个字典，字典的内容是：{'score': 98}
- 使用pop操作，删除这个列表的第3个元素
- 新生成一个列表['1', 'good', 'yes']，使用extend操作，将这个新列表附加到原有的列表当中
- 使用del关键字删除这个列表。注意是删除列表，不是清空列表
- 现在有一个列表，当中包含了数字字符和普通字符，形如['1', '2', '3', 'a', 'abc', 'efg']，请使用结合str的`isalpha`或`isalpha`，利用列表推导，实现如下的功能：将原有列表当中的数字类型的字符进行保留，其他的删除，最后形成如['1', '2', '3']这样的列表。
- 使用`dict`方法构造一个字典，要求字典当中包含下面3个键：address，phonenumber和id
- 使用update操作，将上述的字典进行更新，id更新为9，同时新增一个键值对：email
- 使用pop操作，将字典当中的所有元素删除。提示：请使用`for`循环针对字典的所有key进行操作
- 构造一个字典，使用`items`和`for`对字典进行遍历访问。同时，使用`get`操作，获取该字典当中名为'hello'的键所对应的值
- 通过`pydoc dict`查看字典的操作函数，并使用`has_key`，`popitem`操作字典，观察并分析结果。